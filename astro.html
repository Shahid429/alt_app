<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Stream Player</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/shaka-player.ui.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/controls.min.css" crossorigin="anonymous">
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        #player-container {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
        }

        .shaka-video-container {
            height: 100%;
            width: 100%;
        }

        video {
            height: 100%;
            width: 100%;
        }

        .shaka-spinner-container { 
            display: none; 
        }
    </style>
</head>
<body>
    <div id="player-container">
        <div data-shaka-player-container class="shaka-video-container">
            <video autoplay data-shaka-player id="video" poster="#"></video>
        </div>
    </div>
    <script defer src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>

    <script>
        (function(){var a=['getNetworkingEngine','configure','ui','Player','registerRequestFilter','addEventListener','installAll','getElementById','querySelector','error','load'];(function(b,e){var f=function(g){while(--g){b['push'](b['shift']());}};f(++e);}(a,0x15b));var b=function(c,d){c=c-0x0;var e=a[c];return e;};async function initPlayer(){try{const urlParams=new URLSearchParams(window['location']['search']);const path=urlParams['get']('path');const response=await fetch('config.json');const config=await response['json']();const manifestUri=config[path];shaka['polyfill'][b('0x6')]();if(shaka[b('0x3')]['isBrowserSupported']()){const video=document[b('0x7')]('video');const container=document[b('0x8')]('[data-shaka-player-container]');const player=new shaka['Player'](video);const ui=new shaka[b('0x2')]['Overlay'](player,container,video);player[b('0x1')]({'streaming':{'bufferingGoal':0x3c,'rebufferingGoal':0x1e,'bufferBehind':0x1e,'retryParameters':{'timeout':0x0,'maxAttempts':0x5,'baseDelay':0x3e8,'backoffFactor':0x2,'fuzzFactor':0.5}},'manifest':{'retryParameters':{'timeout':0x0,'maxAttempts':0x5,'baseDelay':0x3e8,'backoffFactor':0x2,'fuzzFactor':0.5},'dash':{'ignoreSuggestedPresentationDelay':!![],'clockSyncUri':''}},'abr':{'enabled':!![],'defaultBandwidthEstimate':0xf4240,'switchInterval':0x1}});player[b('0x0')]()[b('0x4')](function(_,request){request['allowCrossSiteCredentials']=![];delete request['headers']['Origin'];delete request['headers']['Referer'];});player[b('0x5')](b('0x9'),event=>{console['error']('Error\x20code',event['detail']['code'],'object',event['detail']);});await player[b('0xa')](manifestUri);ui['configure']({'addBigPlayButton':!![],'addSeekBar':!![],'controlPanelElements':['play_pause','time_and_duration','spacer','mute','volume','quality','fullscreen',],'overflowMenuButtons':['quality','captions','language','picture_in_picture']});console['log']('Player\x20initialized');}else{console['error']('Browser\x20not\x20supported');}}catch(error){console['error']('Error\x20initializing\x20player:',error);}}if(document['readyState']==='loading'){document['addEventListener']('DOMContentLoaded',initPlayer);}else{initPlayer();}})();
    </script>

    <script>
        // Additional CORS handling
        (function() {
            const originalFetch = window.fetch;
            window.fetch = function(url, options = {}) {
                if (url.includes('dai.google.com')) {
                    options.mode = 'cors';
                    options.credentials = 'omit';
                    if (!options.headers) {
                        options.headers = {};
                    }
                    delete options.headers['Origin'];
                    delete options.headers['Referer'];
                    delete options.headers['Access-Control-Allow-Origin'];
                }
                return originalFetch(url, options);
            };
        })();
    </script>
</body>
</html>
